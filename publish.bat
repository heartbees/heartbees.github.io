@echo off
chcp 65001 > nul  # è§£å†³ä¸­æ–‡ä¹±ç 
set "commit_msg=%~1"

:: ========== 1. æ£€æŸ¥æäº¤ä¿¡æ¯ ==========
if "%commit_msg%"=="" (
    echo âŒ Error: è¯·è¾“å…¥æäº¤ä¿¡æ¯ï¼
    echo âœ… ç¤ºä¾‹: .\publish.bat "feat: æ–°å¢å…³äºé¡µ+å°é¢å›¾"
    pause
    exit /b 1
)

:: ========== 2. æ¸…ç†æ—§äº§ç‰©ï¼ˆç¡®ä¿ç¼–è¯‘æœ€æ–°å†…å®¹ï¼‰ ==========
echo ğŸ§¹ æ¸…ç†æ—§ç¼–è¯‘äº§ç‰©å’Œç¼“å­˜...
if exist "public" rd /s /q "public"  # åˆ é™¤æ—§é™æ€æ–‡ä»¶
if exist "resources" rd /s /q "resources"  # åˆ é™¤Hugoç¼“å­˜
echo âœ… æ¸…ç†å®Œæˆ

:: ========== 3. ç¼–è¯‘Hugoé™æ€æ–‡ä»¶ï¼ˆå¸¦é”™è¯¯åˆ¤æ–­ï¼‰ ==========
echo ğŸ”¨ å¼€å§‹ç¼–è¯‘Hugoé™æ€æ–‡ä»¶...
hugo
if %errorlevel% neq 0 (  # ç¼–è¯‘å¤±è´¥åˆ™ç»ˆæ­¢è„šæœ¬
    echo âŒ Hugoç¼–è¯‘å¤±è´¥ï¼è¯·æ£€æŸ¥æœ¬åœ°é…ç½®/æ¨¡æ¿æ˜¯å¦æœ‰é”™è¯¯
    pause
    exit /b 1
)
echo âœ… ç¼–è¯‘æˆåŠŸ

:: ========== 4. æ¨é€é™æ€æ–‡ä»¶åˆ° GitHub Pages ä¸“ç”¨åˆ†æ”¯ï¼ˆgh-pagesï¼‰ ==========
echo ğŸš€ æ¨é€é™æ€æ–‡ä»¶åˆ° gh-pages åˆ†æ”¯...
cd public || (  # è¿›å…¥publicå¤±è´¥åˆ™ç»ˆæ­¢
    echo âŒ æ‰¾ä¸åˆ°publicæ–‡ä»¶å¤¹ï¼ˆç¼–è¯‘å¤±è´¥ï¼‰
    pause
    exit /b 1
)
git add .
:: å¤„ç†â€œæ— æ–°å†…å®¹æäº¤â€çš„æƒ…å†µ
git commit -m "%commit_msg%" || (
    echo âš ï¸  é™æ€æ–‡ä»¶æ— æ–°å†…å®¹éœ€è¦æäº¤ï¼ˆå·²åŒæ­¥æœ€æ–°ï¼‰
)
git push origin gh-pages  # æ ¸å¿ƒï¼šæ¨åˆ°gh-pagesåˆ†æ”¯ï¼ˆPagesé»˜è®¤è¯»å–ï¼‰
if %errorlevel% neq 0 (
    echo âŒ é™æ€æ–‡ä»¶æ¨é€å¤±è´¥ï¼è¯·æ£€æŸ¥Gitç½‘ç»œ/åˆ†æ”¯æƒé™
    cd ..
    pause
    exit /b 1
)
cd ..
echo âœ… é™æ€æ–‡ä»¶æ¨é€æˆåŠŸ

:: ========== 5. æ¨é€åšå®¢æºç åˆ° main åˆ†æ”¯ï¼ˆå¯é€‰ï¼Œå¤‡ä»½æºç ï¼‰ ==========
echo ğŸ“¦ æ¨é€åšå®¢æºç åˆ° main åˆ†æ”¯ï¼ˆå¤‡ä»½ï¼‰...
git add .
git commit -m "[æºç ] %commit_msg%" || (
    echo âš ï¸  æºç æ— æ–°å†…å®¹éœ€è¦æäº¤
)
git push origin main
if %errorlevel% neq 0 (
    echo âŒ æºç æ¨é€å¤±è´¥ï¼è¯·æ£€æŸ¥Gitç½‘ç»œ
    pause
    exit /b 1
)
echo âœ… æºç æ¨é€æˆåŠŸ

:: ========== 6. å®Œæˆæç¤º ==========
echo.
echo ğŸ‰ å‘å¸ƒæˆåŠŸï¼
echo â³ ç­‰å¾… 5-10 åˆ†é’Ÿåè®¿é—®ï¼šhttps://heartbees.github.io
echo ğŸ’¡ å¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨ï¼šCtrl+F5ï¼ˆéšç§çª—å£è®¿é—®æ›´å‡†ç¡®ï¼‰
pause